(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[8179],{247465:(e,t,n)=>{"use strict";n.d(t,{isCancelled:()=>r,makeCancelable:()=>a});class i extends Error{constructor(){super("CancelToken")}}function a(e){let t=!1;return{promise:new Promise(((n,a)=>{e.then((e=>t?a(new i):n(e))),e.catch((e=>a(t?new i:e)))})),cancel(){t=!0}}}function r(e){return e instanceof i}},865266:(e,t,n)=>{"use strict";n.d(t,{useRovingTabindexElement:()=>o});var i=n(50959),a=n(718736),r=n(855393);function o(e,t=[]){const[n,o]=(0,i.useState)(!1),s=(0,a.useFunctionalRefObject)(e);return(0,r.useIsomorphicLayoutEffect)((()=>{const e=s.current;if(null===e)return;const t=e=>{switch(e.type){case"roving-tabindex:main-element":o(!0);break;case"roving-tabindex:secondary-element":o(!1)}};return e.addEventListener("roving-tabindex:main-element",t),e.addEventListener("roving-tabindex:secondary-element",t),()=>{e.removeEventListener("roving-tabindex:main-element",t),e.removeEventListener("roving-tabindex:secondary-element",t)}}),t),[s,n?0:-1]}},466515:e=>{e.exports={container:"container-RoCcHn9S",title:"title-RoCcHn9S",inactive:"inactive-RoCcHn9S",titleText:"titleText-RoCcHn9S",indicator:"indicator-RoCcHn9S",disconnected:"disconnected-RoCcHn9S",failed:"failed-RoCcHn9S",connecting:"connecting-RoCcHn9S",connected:"connected-RoCcHn9S",loginTooltip:"loginTooltip-RoCcHn9S"}},141589:e=>{e.exports={wrapper:"wrapper-mXzF5cTO",button:"button-mXzF5cTO"}},599730:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getTerminalConfigSet:()=>y});var i=n(609838);const a={paper_trading:{name:"paper_trading",title:i.t(null,void 0,n(666803)),buttonOpenTooltip:i.t(null,void 0,n(713935)),buttonCloseTooltip:i.t(null,void 0,n(124939)),ctor:null,_gaEvent:"Trading Panel"},backtesting:{name:"backtesting",title:i.t(null,void 0,n(435155)),buttonOpenTooltip:i.t(null,void 0,n(248686)),buttonCloseTooltip:i.t(null,void 0,n(70046)),ctor:null,_gaEvent:"Strategy Tester"},replay_trading:{name:"replay_trading",title:i.t(null,void 0,n(169623)),buttonOpenTooltip:i.t(null,void 0,n(419912)),buttonCloseTooltip:i.t(null,void 0,n(161307)),ctor:null,_gaEvent:"Replay Trading Panel"}};var r=n(650151),o=n(765296),s=(n(894862),n(556239));class l{constructor(e){this._contentRenderer=Promise.resolve(),this._spinnerContainer=document.createElement("div"),this._offlineScreenContainer=document.createElement("div"),this._renderer=Promise.resolve(),this._bridge=e,(0,o.waitTradingService)().then((e=>{this._trading=e,this.onStatusChange(e.connectStatus()),this._trading.onConnectionStatusChange.subscribe(this,this.onStatusChange)})),Promise.all([n.e(7833),n.e(7102)]).then(n.bind(n,974063)).then((e=>{e.render(this._spinnerContainer)})),(0,s.renderOfflineScreen)((0,r.ensureDefined)(this._offlineScreenContainer))}activate(){this._contentRenderer.then((()=>{this._content&&this._content.drawAttention&&this._content.drawAttention()}))}onStatusChange(e,t){this._connectStatus!==e&&(this._connectStatus=this._trading.connectStatus(),window.navigator.onLine?(this._contentRenderer=Promise.resolve(),
this._content&&this._content.remove(),2===e&&this._renderSpinner(),3!==e&&4!==e?1===e&&("REPLAYBROKER"===this._trading.activeBroker()?.currentBroker()?this._renderInReplayState():this._renderAccountManager(this._trading.activeBroker())):this._renderSpinner()):this._renderOfflineScreen())}async _renderInReplayState(){}_renderSpinner(){this._bridge.container.innerText="",this._content=this._bridge.container.appendChild(this._spinnerContainer)}_renderOfflineScreen(){this._bridge.container.innerText="",this._content=this._bridge.container.appendChild(this._offlineScreenContainer)}async _createAccountManager(e){const{AccountManager:t}=await Promise.all([n.e(4958),n.e(8185),n.e(1681),n.e(3039),n.e(6612),n.e(8933),n.e(6032),n.e(3672),n.e(3425),n.e(8752),n.e(8158),n.e(4391),n.e(1462),n.e(6052),n.e(874),n.e(442),n.e(1450),n.e(7702),n.e(2950),n.e(4059),n.e(9964),n.e(5001),n.e(7691),n.e(9787),n.e(2568),n.e(563),n.e(8258),n.e(579),n.e(5728),n.e(8756),n.e(7727),n.e(3251),n.e(2433),n.e(2212),n.e(4134),n.e(4258),n.e(987),n.e(3760),n.e(1054),n.e(8354)]).then(n.bind(n,603903)),{SummaryFieldsVisibilityManager:i}=await Promise.all([n.e(4958),n.e(8185),n.e(1681),n.e(3039),n.e(6612),n.e(8933),n.e(6032),n.e(3672),n.e(3425),n.e(8752),n.e(8158),n.e(4391),n.e(1462),n.e(6052),n.e(874),n.e(442),n.e(1450),n.e(7702),n.e(2950),n.e(4059),n.e(9964),n.e(5001),n.e(7691),n.e(9787),n.e(2568),n.e(563),n.e(8258),n.e(579),n.e(5728),n.e(8756),n.e(7727),n.e(3251),n.e(2433),n.e(2212),n.e(4134),n.e(4258),n.e(987),n.e(3760),n.e(1054),n.e(8354)]).then(n.bind(n,842960));if(this._contentRenderer!==this._renderer)return;this._content&&this._content.remove();const a=new i((0,r.ensureNotNull)(e).accountManagerInfo().summary,this._trading.getBrokerTradingSettingsStorage);this._content=await t.create({broker:e,bridge:this._bridge,mode:1,summaryFieldsVisibilityManager:a})}_renderAccountManager(e){this._renderer=this._contentRenderer=this._createAccountManager(e)}_renderBrokerSelectScreen(){0}}var c=n(50959),d=n(497754),u=n.n(d),h=n(247465),g=n(760775),p=n(487223),_=n(898237),v=n(865266),b=n(141589);const m=i.t(null,void 0,n(366823));function S(e){const{onClick:t,onWidthChange:a,tradeButtonWidth:r,showHint:o,isActive:s}=e,[,l]=(0,v.useRovingTabindexElement)(null),d=(0,c.useRef)(null);(0,c.useEffect)((()=>{a(d.current?.offsetWidth??0)}),[]);i.t(null,void 0,n(748157)),i.t(null,{replace:{tradeButtonText:m}},n(271055));return c.createElement("div",{className:b.wrapper,ref:d},c.createElement(_.LightButton,{size:"xsmall",color:"gray",onClick:t,variant:s?"primary":"secondary",title:i.t(null,void 0,n(319133)),className:u()("apply-common-tooltip",b.button),"area-label":i.t(null,void 0,n(319133)),tabIndex:l,"data-name":"trade-panel-button"},m),!1)}var C=n(466515);const T=i.t(null,void 0,n(332668)),f={4:"failed",2:"connecting",1:"connected",3:"disconnected"},k={4:i.t(null,void 0,n(935284)),2:i.t(null,void 0,n(366891)),1:i.t(null,void 0,n(618305)),3:i.t(null,void 0,n(551772))};class R extends c.PureComponent{constructor(e){super(e),this._trading=null,
this._tradingServiceCancelable=null,this._didMount=!1,this._titleClick=()=>{const{onClick:e}=this.props;e&&e()},this._update=()=>{const e=this._trading,t=e&&e.activeBroker(),n=e?e.connectStatus():3,i=null!==e,a=!!i&&e.tradingPanel.isOpeningAvailable.value(),r=!!i&&e.tradingPanel.isOpened.value(),o=window.is_authenticated&&i&&null!==t&&1===n&&"REPLAYBROKER"!==t.metainfo().id,s=!!i&&e.isInReplay().value();this.setState({status:n,hasActiveBroker:o,title:o?t.accountManagerInfo().accountTitle:T,isOpeningTradingPanelAvailable:a,isTradingPanelOpened:r,isInReplay:s})},this._handleClickTradeButton=()=>{if(null!==this._trading){{const e=this._trading?.activeBroker()?.metainfo();if(void 0!==e?.customUI?.showOrderDialog){const{symbol:t}=this._trading.linking().value(),n={symbol:t};return void e.customUI.showOrderDialog(n)}}this._trading.toggleTradingPanelVisibility()}},this.state={status:3,hasActiveBroker:!1,title:T,isOpeningTradingPanelAvailable:!1,isTradingPanelOpened:!1,tradeButtonWidth:0,shouldShowHint:!1,isInReplay:!1}}componentDidMount(){const e=(0,o.tradingService)();null===e?(this._tradingServiceCancelable=(0,h.makeCancelable)((0,o.waitTradingService)()),this._tradingServiceCancelable.promise.then(this._onTradingService.bind(this))):this._onTradingService(e)}componentDidUpdate(e,t){if(!this._didMount)return void(this._didMount=!0);const{isTradingPanelOpened:n,hasActiveBroker:i}=this.state;t.isTradingPanelOpened&&!n&&this.setState({shouldShowHint:!0}),this.state.shouldShowHint&&(!t.isTradingPanelOpened&&n||t.hasActiveBroker&&!i)&&this.setState({shouldShowHint:!1})}componentWillUnmount(){this._cancelWaitingTrading(),null!==this._trading&&(this._trading.onBrokerChange.unsubscribe(this,this._update),this._trading.onConnectionStatusChange.unsubscribe(this,this._update),this._trading.tradingPanel.isOpeningAvailable.unsubscribe(this._update),this._trading.tradingPanel.isOpened.unsubscribe(this._update),this._trading.isInReplay().unsubscribe(this._update))}render(){const{isActive:e,tooltip:t,dataName:n}=this.props,{status:i,hasActiveBroker:a,title:r,tradeButtonWidth:o,isInReplay:s}=this.state,l=this._trading?.shouldShowTradeButton()&&!s,u=void 0!==this.props.dataName,h={"--trade-button-width":l?o:0};return c.createElement(c.Fragment,null,c.createElement(p.FooterToolbarTab,{className:d(g.bottomTradingTabClassName,C.container,C[f[i]],!a&&C.inactive),style:h,isActive:e,onClick:this._titleClick,"data-name":n,tooltip:t},c.createElement("span",{className:C.title},c.createElement("span",{className:C.titleText},r)),c.createElement("div",{className:d(C.indicator,"apply-common-tooltip"),title:k[i]})),l&&c.createElement(S,{onClick:this._handleClickTradeButton,tradeButtonWidth:o,onWidthChange:e=>this.setState({...this.state,tradeButtonWidth:e}),showHint:u,isActive:this.state.isTradingPanelOpened}))}_onTradingService(e){this._cancelWaitingTrading(),this._trading=e,e.onBrokerChange.subscribe(this,this._update),e.onConnectionStatusChange.subscribe(this,this._update),e.tradingPanel.isOpeningAvailable.subscribe(this._update),
e.tradingPanel.isOpened.subscribe(this._update),this._trading.isInReplay().subscribe(this._update),this._update()}_cancelWaitingTrading(){null!==this._tradingServiceCancelable&&(this._tradingServiceCancelable.cancel(),this._tradingServiceCancelable=null)}}var w=n(144421);function y(){const e={paper_trading:{ctor:l,customTitleComponent:R,buttonOpenTooltip:i.t(null,void 0,n(951065)),buttonCloseTooltip:i.t(null,void 0,n(287902))}};return(0,w.merge)((0,w.clone)(a),e)}},487223:(e,t,n)=>{"use strict";n.d(t,{FooterToolbarTab:()=>o});var i=n(50959),a=n(865266),r=n(795641);function o(e){const{isActive:t,tooltip:n,...o}=e,[s,l]=(0,a.useRovingTabindexElement)(null);return i.createElement(r.ToolWidgetButton,{tag:"button","aria-label":n,...o,ref:s,isActive:t,"data-active":t,"aria-pressed":t,tabIndex:l,"data-tooltip":n})}}}]);